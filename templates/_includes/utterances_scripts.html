{% macro comments_script_utterances(repo, id, label, theme) %}
<script src="https://utteranc.es/client.js"
        data-repo="{{ repo }}"
        data-issue-term="{{ id }}"
        data-label="{{ label }}"
        data-theme="{{ theme }}"
        crossorigin="anonymous"
        async>
</script>
<script>
    // Update Utterances theme when Bootstrap theme changes
    function updateUtterancesTheme() {
        const currentTheme = document.documentElement.getAttribute('data-bs-theme');
        const utterancesTheme = currentTheme === 'dark' ? 'github-dark' : 'github-light';

        const iframe = document.querySelector('.utterances-frame');
        if (iframe) {
            const message = {
                type: 'set-theme',
                theme: utterancesTheme
            };
            iframe.contentWindow.postMessage(message, 'https://utteranc.es');
        }
    }

    // Watch for theme changes
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.type === 'attributes' && mutation.attributeName === 'data-bs-theme') {
                updateUtterancesTheme();
            }
        });
    });

    // Start observing after Utterances iframe loads
    window.addEventListener('load', () => {
        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['data-bs-theme']
        });
    });
</script>
{% endmacro %}
